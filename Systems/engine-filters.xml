<?xml version="1.0"?>
<!--
Filters that compute values for various instruments in the Lochkeed 1049h.
Copyright (C) 2015 Ludovic Brenta <ludovic@ludovic-brenta.org>

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.
-->
<PropertyList>

  <filter>
    <name>BMEP #1: compute BMEP from engine power and RPM</name>
    <debug>false</debug>
    <type>gain</type>
    <input>
      <expression>
        <div>
          <property>fdm/jsbsim/propulsion/engine[0]/power-hp</property>
          <property>engines/engine[0]/rpm</property>
        </div>
      </expression>
    </input>
    <gain>260.0</gain>
    <output>/engines/engine[0]/bmep</output>
  </filter>

  <filter>
    <name>BMEP #2: compute BMEP from engine power and RPM</name>
    <debug>false</debug>
    <type>gain</type>
    <input>
      <expression>
        <div>
          <property>fdm/jsbsim/propulsion/engine[1]/power-hp</property>
          <property>engines/engine[1]/rpm</property>
        </div>
      </expression>
    </input>
    <input>0</input>
    <gain>260.0</gain>
    <output>/engines/engine[1]/bmep</output>
  </filter>

  <filter>
    <name>BMEP #3: compute BMEP from engine power and RPM</name>
    <debug>false</debug>
    <type>gain</type>
    <input>
      <expression>
        <div>
          <property>fdm/jsbsim/propulsion/engine[2]/power-hp</property>
          <property>engines/engine[2]/rpm</property>
        </div>
      </expression>
    </input>
    <input>0</input>
    <gain>260.0</gain>
    <output>/engines/engine[2]/bmep</output>
  </filter>

  <filter>
    <name>BMEP #4: compute BMEP from engine power and RPM</name>
    <debug>false</debug>
    <type>gain</type>
    <input>
      <expression>
        <div>
          <property>fdm/jsbsim/propulsion/engine[3]/power-hp</property>
          <property>engines/engine[3]/rpm</property>
        </div>
      </expression>
    </input>
    <input>0</input>
    <gain>260.0</gain>
    <output>/engines/engine[3]/bmep</output>
  </filter>

  <filter>
    <name>Fuel Pressure #1: fuel pressure decreases as fuel flow increases</name>
    <debug>false</debug>
    <type>gain</type>
    <input>
      <condition>
        <property>engines/engine[0]/running</property>
      </condition>
      <property>engines/engine[0]/fuel-flow-gph</property>
      <scale>-0.057</scale>
      <offset>27</offset>
    </input>
    <input>0</input>
    <output>/engines/engine[0]/est-fuelpress</output>
  </filter>
  
  <filter>
    <name>Fuel Pressure #2: fuel pressure decreases as fuel flow increases</name>
    <debug>false</debug>
    <type>gain</type>
    <input>
      <condition>
        <property>engines/engine[1]/running</property>
      </condition>
      <property>engines/engine[1]/fuel-flow-gph</property>
      <scale>-0.057</scale>
      <offset>27</offset>
    </input>
    <input>0</input>
    <output>/engines/engine[1]/est-fuelpress</output>
  </filter>
  
  <filter>
    <name>Fuel Pressure #3: fuel pressure decreases as fuel flow increases</name>
    <debug>false</debug>
    <type>gain</type>
    <input>
      <condition>
        <property>engines/engine[2]/running</property>
      </condition>
      <property>engines/engine[2]/fuel-flow-gph</property>
      <scale>-0.057</scale>
      <offset>27</offset>
    </input>
    <input>0</input>
    <output>/engines/engine[2]/est-fuelpress</output>
  </filter>
  
  <filter>
    <name>Fuel Pressure #4: fuel pressure decreases as fuel flow increases</name>
    <debug>false</debug>
    <type>gain</type>
    <input>
      <condition>
        <property>engines/engine[3]/running</property>
      </condition>
      <property>engines/engine[3]/fuel-flow-gph</property>
      <scale>-0.057</scale>
      <offset>27</offset>
    </input>
    <input>0</input>
    <output>/engines/engine[3]/est-fuelpress</output>
  </filter>

  <!-- the BSFC value that JSBSim computes is good only at sea level;
       as altitude increases the power output of the engines does not
       decrease enough.  This filter increases BSFC to correct that.
       See Engines/WrightCyclone-972TC18DA3.xml for details. -->

  <filter>
    <name>BSFC #1: Basic Specific Fuel Consumption as a function of altitude</name>
    <debug>false</debug>
    <type>gain</type>
    <input>
      <condition>
        <equals>
          <property>fdm/jsbsim/propulsion/engine[0]/boost-speed</property>
          <value>0</value>
        </equals>
      </condition>
      <!-- Linear interpolation: 0 .. 5800 ft -> 0.198 .. 0.259 -->
      <property>position/altitude-ft</property>
      <scale>0.000010516</scale>
      <offset>0.198</offset>
    </input>
    <input>
      <condition>
        <equals>
          <property>fdm/jsbsim/propulsion/engine[0]/boost-speed</property>
          <value>1</value>
        </equals>
      </condition>
      <!-- linear interpolation: 10050 .. 16400 ft -> 0.242 .. 0.251 -->
      <property>position/altitude-ft</property>
      <scale>0.000001416</scale>
      <offset>0.228</offset>
    </input>
    <output>/fdm/jsbsim/propulsion/engine[0]/bsfc-lbs_hphr</output>
  </filter>

  <filter>
    <name>BSFC #2: Basic Specific Fuel Consumption as a function of altitude</name>
    <debug>false</debug>
    <type>gain</type>
    <input>
      <condition>
        <equals>
          <property>fdm/jsbsim/propulsion/engine[1]/boost-speed</property>
          <value>0</value>
        </equals>
      </condition>
      <!-- Linear interpolation: 0 .. 5800 ft -> 0.198 .. 0.259 -->
      <property>position/altitude-ft</property>
      <scale>0.000010516</scale>
      <offset>0.198</offset>
    </input>
    <input>
      <condition>
        <equals>
          <property>fdm/jsbsim/propulsion/engine[1]/boost-speed</property>
          <value>1</value>
        </equals>
      </condition>
      <!-- linear interpolation: 10050 .. 16400 ft -> 0.242 .. 0.251 -->
      <property>position/altitude-ft</property>
      <scale>0.000001416</scale>
      <offset>0.228</offset>
    </input>
    <output>/fdm/jsbsim/propulsion/engine[1]/bsfc-lbs_hphr</output>
  </filter>

  <filter>
    <name>BSFC #3: Basic Specific Fuel Consumption as a function of altitude</name>
    <debug>false</debug>
    <type>gain</type>
    <input>
      <condition>
        <equals>
          <property>fdm/jsbsim/propulsion/engine[2]/boost-speed</property>
          <value>0</value>
        </equals>
      </condition>
      <!-- Linear interpolation: 0 .. 5800 ft -> 0.198 .. 0.259 -->
      <property>position/altitude-ft</property>
      <scale>0.000010516</scale>
      <offset>0.198</offset>
    </input>
    <input>
      <condition>
        <equals>
          <property>fdm/jsbsim/propulsion/engine[2]/boost-speed</property>
          <value>1</value>
        </equals>
      </condition>
      <!-- linear interpolation: 10050 .. 16400 ft -> 0.242 .. 0.251 -->
      <property>position/altitude-ft</property>
      <scale>0.000001416</scale>
      <offset>0.228</offset>
    </input>
    <output>/fdm/jsbsim/propulsion/engine[2]/bsfc-lbs_hphr</output>
  </filter>

  <filter>
    <name>BSFC #4: Basic Specific Fuel Consumption as a function of altitude</name>
    <debug>false</debug>
    <type>gain</type>
    <input>
      <condition>
        <equals>
          <property>fdm/jsbsim/propulsion/engine[3]/boost-speed</property>
          <value>0</value>
        </equals>
      </condition>
      <!-- Linear interpolation: 0 .. 5800 ft -> 0.198 .. 0.259 -->
      <property>position/altitude-ft</property>
      <scale>0.000010516</scale>
      <offset>0.198</offset>
    </input>
    <input>
      <condition>
        <equals>
          <property>fdm/jsbsim/propulsion/engine[3]/boost-speed</property>
          <value>1</value>
        </equals>
      </condition>
      <!-- linear interpolation: 10050 .. 16400 ft -> 0.242 .. 0.251 -->
      <property>position/altitude-ft</property>
      <scale>0.000001416</scale>
      <offset>0.228</offset>
    </input>
    <output>/fdm/jsbsim/propulsion/engine[3]/bsfc-lbs_hphr</output>
  </filter>

</PropertyList>
